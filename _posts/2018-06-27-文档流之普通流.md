---
layout: post
title: "文档流之普通流"
date: 2018-06-27 
description: "CSS,BFC"
tag: CSS
---   

CSS中的文档流分类普通流，定位流和浮动流，今天首先来了解一下普通流。

## 普通流是什么？

普通流定义了其中元素的布局规则，只要不是float和绝对定位方式布局的，都归为普通流。普通流主要包含有块级格式上下文(Block formatting context,BFC)、行内格式上下文(Inline formatting context,IFC)和相对定位。

## 块级格式上下文(BFC)

很多的CSS书籍并没有介绍块格式上下文的概念，而理解了块格式上下文对于CSS的一些布局现象会有很大的帮助。BFC是只有块级元素参与布局的一块独立渲染区域，定义了其中的块级元素的布局规则。

**创建BFC**

当满足一下条件之一时，会形成一个BFC区域：

1. float不为none;
2. position为absolute或fixed
3. display为 table-cell,table-caption,inline-block,flex,inline-flex之一
4. overflow不为visible

通常，可以用overflow:hidden来建立BFC。

**BFC的布局规则**

1. BFC内部的box会在垂直方向一个接一个地放置；
2. BFC内部垂直方向两个相邻的box的margin会产生重叠，只显示较大的外边距；
3. 所有属于BFC的box都默认左对齐，并且它们的左边距可以触及到容器container的左边，即使存在浮动也是如此（右浮动是靠右）；
4. BFC区域不会和浮动元素区域重叠；
5. 计算BFC高度时,浮动元素也会参与计算；
6. BFC在页面是一个独立容器,外面不会影响里面,里面不会影响外面

**BFC的应用**

***1.阻止margin重叠***

让两个相邻box分属不同的BFC，这样就能阻止它们的外边距重叠。具体做法可以给其中一个div外面包一个div，然后通过触发外面这个div的BFC。

***2.清除内部浮动***

如果一个容器里面包含浮动元素，但该容器却不会被其中的浮动元素的高度撑开，使得容器的高度为0.
我们可以通过触发父div的BFC属性(overflow: hidden;)，使下面的子div都处在父div的同一个BFC区域之内，根据BFC的布局规则5，浮动元素会参与计算BFC容器的高度，从而达到清除浮动的目的。

***3.阻止文本换行***

大多数情况，文本将会环绕浮动元素（如figure1），但有时候这并不是我们期望的，我们想要的是figure2所示的效果。

![](https://i.imgur.com/q6J3E48.png)

当浮动元素和非浮动元素的一起排列时，可以将非浮动元素分成两层，下层为元素本身盒模型，而上层为元素内的content、文字等，元素本身会被浮动元素盖住，而元素内容会提升半层，与浮动元素一起浮动，因此会出现如Figure 1的文字环绕效果。

我们根据BFC规则4，BFC区域不会和浮动元素区域重叠，通过将右边的元素建立一个BFC区域，达到Figure 2的效果。Figure 2的效果也正是自适应两栏布局的效果。

## 行内格式上下文(IFC)

行内格式上下文只有行内元素参与，它规定了内部的行内元素排列规则。

先来了解一波基本术语：

***行内框：***对于普通的文本等，行内框的高度刚好等于其line-height的值；而对于图片等替换元素，行内框的高度等于元素的固有高度加上可能有的外边距、边框或内边距。

***行框：*** 行框的上边界位于最高行内框的上边界，行框的下边界位于行内框的下边界。

如果一个行内元素的font-size为15px，则其所有em框的高度都为15px，所以内容区的高度就为15px，如下图所示：

![](https://i.imgur.com/SoYvgBw.png)

如果line-height为21px，则与内容去相差6px，浏览器将这6px分为3px和3px，分别加到内容区的顶部和底部，这就得到了行内框，如下图所示：

![](https://i.imgur.com/IvItxQS.png)

如果大多数的文本的font-size都为12px，但有一个元素的font-size为24px，那么这个元素的line-height和font-size之差为-12px，一分为二应用到内容区后得到行内框高度也为12px，因此行内框的高度实际上小于内容区，如下所示：

![](https://i.imgur.com/PLBCmNO.png)

如果改变了行内框的垂直对齐，如vertical-align:4px，则将元素向上移4px，如果此元素离行内框的顶部不足4px，将导致行内框向上移，差多少px就上移多少px。如下图，加粗字体本身离行内框顶部的距离为0px，给其加上vertical-align:4px，导致行框上移了4px。

![](https://i.imgur.com/jEOCwr1.png)

可见，line-height和font-size两者的大小关系如果设置不合理，将可能使得文字排布出现错位不整齐的现象。如果把元素的边框高度也考虑进去，那么line-height需要设置的更加小心。对此，设置line-height的最好办法是使用一个原始数字值，line-height:1.5代表line-height的值为font-size的1.5倍。

当文本中含有图片时，如果图片的固有高度高于行框，那么行框将会增加高度直到能容纳图片（包括容纳其外边距，边框），图片的底部位于基线上。但其他文本的line-height并不会变化。

参考资料：

[1].OBKoro1.关于CSS-BFC深入理解[DB/OL].https://juejin.im/post/5909db2fda2f60005d2093db.

[2].Pursue.理解CSS中的BFC(块级可视化上下文)[DB/OL].https://www.jianshu.com/p/fc1d61dace7b

[3].ixygj197875.CSS普通流和行格式化上下文IFC[DB/OL].https://blog.csdn.net/ixygj197875/article/details/79344472